<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KV Grid Control Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {
      background: radial-gradient(circle at top left, #0f172a, #020617);
      color: #e5e7eb;
      font-family: 'Segoe UI', sans-serif;
    }
    .glass {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);  
    }
    .neon {
      box-shadow: 0 0 10px #22d3ee;
    }
  </style>
</head>

<body>
<div id="app" class="flex h-screen overflow-hidden">

  <aside class="w-72 glass border-r border-cyan-500/30 p-6 flex flex-col gap-6">
    <h1 class="text-2xl font-bold text-cyan-400">
      <i class="fas fa-network-wired"></i> KV Grid
    </h1>

    <div class="text-sm text-gray-400 space-y-2">
      <p><i class="fas fa-server"></i> Controller</p>
      <p class="text-cyan-300">localhost:5000</p>
      <p class="pt-2"><i class="fas fa-copy"></i> Replicas: {{ config.replica_count }}</p>
    </div>

    <button @click="fetchStatus"
            class="mt-auto bg-cyan-600 hover:bg-cyan-700 px-4 py-2 rounded-md neon">
      <i class="fas fa-arrows-rotate"></i> Sync Cluster
    </button>
  </aside>

  <main class="flex-1 p-8 overflow-y-auto">

    <h2 class="text-xl font-bold text-green-400 mb-4">
      <i class="fas fa-circle-nodes"></i> Worker Status Matrix
    </h2>

    <table class="w-full text-sm border border-cyan-500/30 mb-10">
      <thead class="bg-cyan-900/40">
        <tr>
          <th class="p-2 border">Worker</th>
          <th class="p-2 border">Address</th>
          <th class="p-2 border">State</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(w,id) in workers" :key="id"
            class="hover:bg-cyan-900/30">
          <td class="p-2 border">Node {{ id }}</td>
          <td class="p-2 border">{{ w.address }}</td>
          <td class="p-2 border">
            <span v-if="w.alive" class="text-green-400">ONLINE</span>
            <span v-else class="text-red-400">OFFLINE</span>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

      <div class="glass p-6 rounded-xl neon">
        <h3 class="text-lg font-bold text-cyan-400 mb-4">
          <i class="fas fa-terminal"></i> KV Client Terminal
        </h3>

        <label class="text-sm text-gray-400">Target</label>
        <select v-model="targetUrl"
                class="w-full p-2 mb-4 bg-black border border-cyan-500/40 rounded">
          <option value="http://localhost:5000">Controller</option>
          <option v-for="(w,id) in workers" :value="w.address">
            Worker {{ id }}
          </option>
        </select>

        <div class="flex gap-4 mb-4">
          <button @click="mode='get'"
                  :class="mode==='get' ? 'bg-cyan-600' : 'bg-gray-700'"
                  class="flex-1 py-2 rounded">
            GET
          </button>
          <button @click="mode='put'"
                  :class="mode==='put' ? 'bg-purple-600' : 'bg-gray-700'"
                  class="flex-1 py-2 rounded">
            PUT
          </button>
        </div>

        <input v-model="requestKey"
               placeholder="KEY"
               class="w-full p-2 mb-3 bg-black border border-cyan-500/40 rounded">

        <input v-if="mode==='put'"
               v-model="requestVal"
               placeholder="VALUE"
               class="w-full p-2 mb-4 bg-black border border-purple-500/40 rounded">

        <button v-if="mode==='get'"
                @click="executeGet"
                class="w-full bg-cyan-600 py-2 rounded neon">
          FETCH
        </button>

        <button v-if="mode==='put'"
                @click="executePut"
                class="w-full bg-purple-600 py-2 rounded neon">
          COMMIT
        </button>
      </div>

      <!-- âœ… RESPONSE SCREEN -->
      <div class="glass p-6 rounded-xl border border-green-500/50">
        <h3 class="text-lg font-bold text-green-400 mb-3">
          <i class="fas fa-square-poll-vertical"></i> System Output
        </h3>

        <pre class="bg-black text-green-400 p-4 h-64 overflow-auto rounded">
{{ responseLog }}
        </pre>
      </div>

    </div>

  </main>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      config: { replica_count: 0 },
      workers: {},
      targetUrl: "http://localhost:5000",
      mode: "get",
      requestKey: "",
      requestVal: "",
      responseLog: ">> SYSTEM READY"
    }
  },

  mounted() {
    this.fetchStatus();
    setInterval(this.fetchStatus, 3000);
  },

  methods: {
    async fetchStatus() {
      try {
        const res = await fetch("http://localhost:5000/status");
        const data = await res.json();
        this.workers = data.workers;
        this.config = data.config;
      } catch {
        this.responseLog = ">> ERROR: Controller unreachable";
      }
    },

    async executeGet() {
      try {
        const endpoint = this.targetUrl.includes("5000") ?
          "/partition/" : "/kv/";
        const res = await fetch(this.targetUrl + endpoint + this.requestKey);
        const data = await res.json();
        this.responseLog = JSON.stringify(data, null, 2);
      } catch (e) {
        this.responseLog = ">> FETCH FAILED";
      }
    },

    async executePut() {
      try {
        const res = await fetch(`${this.targetUrl}/kv/${this.requestKey}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ value: this.requestVal })
        });
        const data = await res.json();
        this.responseLog = JSON.stringify(data, null, 2);
      } catch (e) {
        this.responseLog = ">> COMMIT FAILED";
      }
    }
  }
}).mount("#app");
</script>

</body>
</html>
